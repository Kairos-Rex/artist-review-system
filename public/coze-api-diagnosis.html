<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coze API é—®é¢˜è¯Šæ–­æŠ¥å‘Š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .issue {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .issue.critical {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .issue.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        
        .issue.info {
            background: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .fix {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .code {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .btn.warning {
            background: #ffc107;
            color: #333;
        }
        
        .btn.danger {
            background: #dc3545;
        }
        
        ul {
            margin-left: 20px;
        }
        
        li {
            margin: 5px 0;
        }
        
        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.ok {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Coze API é—®é¢˜è¯Šæ–­æŠ¥å‘Š</h1>
            <p>åŸºäºå®˜æ–¹æ–‡æ¡£çš„å®Œæ•´APIè°ƒç”¨é—®é¢˜åˆ†æ</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>ğŸ“‹ å½“å‰ä»£ç çŠ¶æ€åˆ†æ</h2>
                <div class="issue info">
                    <h3>âœ… å·²æ­£ç¡®å®ç°çš„åŠŸèƒ½</h3>
                    <ul>
                        <li><span class="status ok">OK</span> Coze API v3 ä¸‰æ­¥æµç¨‹ï¼šå‘èµ·å¯¹è¯ â†’ è½®è¯¢çŠ¶æ€ â†’ è·å–æ¶ˆæ¯</li>
                        <li><span class="status ok">OK</span> æ­£ç¡®çš„APIç«¯ç‚¹ä½¿ç”¨ï¼š<code>https://api.coze.cn/v3/chat</code></li>
                        <li><span class="status ok">OK</span> å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è¯Šæ–­</li>
                        <li><span class="status ok">OK</span> åŠ¨æ€ç”¨æˆ·IDç”Ÿæˆé¿å…å†²çª</li>
                        <li><span class="status ok">OK</span> è½®è¯¢æœºåˆ¶é˜²æ­¢æ— é™ç­‰å¾…</li>
                        <li><span class="status ok">OK</span> è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>âš ï¸ æ½œåœ¨é—®é¢˜åˆ†æ</h2>
                
                <div class="issue warning">
                    <h3>ğŸ”§ é…ç½®ç›¸å…³é—®é¢˜</h3>
                    <p><strong>é—®é¢˜æè¿°ï¼š</strong>ç”¨æˆ·å¯èƒ½æœªæ­£ç¡®é…ç½®APIå¯†é’¥æˆ–æœºå™¨äººID</p>
                    <p><strong>å¸¸è§ç—‡çŠ¶ï¼š</strong></p>
                    <ul>
                        <li>401 Unauthorized - APIå¯†é’¥æ— æ•ˆ</li>
                        <li>404 Not Found - æœºå™¨äººIDä¸å­˜åœ¨</li>
                        <li>403 Forbidden - æƒé™ä¸è¶³</li>
                    </ul>
                </div>
                
                <div class="issue warning">
                    <h3>ğŸ¤– æœºå™¨äººå‘å¸ƒçŠ¶æ€é—®é¢˜</h3>
                    <p><strong>é—®é¢˜æè¿°ï¼š</strong>æœºå™¨äººå¯èƒ½æœªå‘å¸ƒä¸ºAPIæœåŠ¡</p>
                    <p><strong>æ£€æŸ¥æ–¹æ³•ï¼š</strong></p>
                    <ul>
                        <li>åœ¨Cozeå¹³å°ç¡®è®¤æœºå™¨äººå·²å‘å¸ƒ</li>
                        <li>é€‰æ‹©"Bot as API"å‘å¸ƒç±»å‹</li>
                        <li>ç­‰å¾…å®¡æ ¸é€šè¿‡</li>
                    </ul>
                </div>
                
                <div class="issue warning">
                    <h3>ğŸ”‘ PATä»¤ç‰Œæƒé™é—®é¢˜</h3>
                    <p><strong>é—®é¢˜æè¿°ï¼š</strong>Personal Access Tokenå¯èƒ½ç¼ºå°‘å¿…è¦æƒé™</p>
                    <p><strong>å¿…éœ€æƒé™ï¼š</strong></p>
                    <ul>
                        <li>âœ… Botç®¡ç†æƒé™</li>
                        <li>âœ… Chatæƒé™</li>
                        <li>âœ… å¯¹è¯å†å²è®¿é—®æƒé™</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ”§ è§£å†³æ–¹æ¡ˆ</h2>
                
                <div class="fix">
                    <h3>1. éªŒè¯APIé…ç½®</h3>
                    <p>ä½¿ç”¨ä»¥ä¸‹ä»£ç éªŒè¯APIå¯†é’¥å’Œæœºå™¨äººIDæ ¼å¼ï¼š</p>
                    <div class="code">
// éªŒè¯APIå¯†é’¥æ ¼å¼
function validateApiKey(apiKey) {
    if (!apiKey) return { valid: false, message: 'APIå¯†é’¥æœªå¡«å†™' };
    if (!apiKey.startsWith('pat_')) return { valid: false, message: 'APIå¯†é’¥åº”ä»¥"pat_"å¼€å¤´' };
    if (apiKey.length < 20) return { valid: false, message: 'APIå¯†é’¥é•¿åº¦ä¸æ­£ç¡®' };
    return { valid: true, message: 'APIå¯†é’¥æ ¼å¼æ­£ç¡®' };
}

// éªŒè¯æœºå™¨äººIDæ ¼å¼
function validateBotId(botId) {
    if (!botId) return { valid: false, message: 'æœºå™¨äººIDæœªå¡«å†™' };
    if (!/^\d+$/.test(botId)) return { valid: false, message: 'æœºå™¨äººIDåº”ä¸ºçº¯æ•°å­—' };
    return { valid: true, message: 'æœºå™¨äººIDæ ¼å¼æ­£ç¡®' };
}
                    </div>
                </div>
                
                <div class="fix">
                    <h3>2. å®Œæ•´çš„é”™è¯¯å¤„ç†ä¼˜åŒ–</h3>
                    <p>åŸºäºCoze API v3æ–‡æ¡£çš„é”™è¯¯å¤„ç†ï¼š</p>
                    <div class="code">
// å¢å¼ºçš„é”™è¯¯å¤„ç†
if (!response.ok) {
    const errorData = await response.json();
    
    // Cozeç‰¹æœ‰é”™è¯¯ç å¤„ç†
    if (errorData.code === 702242001) {
        throw new Error('å‚æ•°ä¼ é€’é”™è¯¯ï¼šè¯·æ£€æŸ¥è¯·æ±‚ä½“æ ¼å¼å’Œå¿…éœ€å‚æ•°');
    }
    
    // HTTPçŠ¶æ€ç å¤„ç†
    switch (response.status) {
        case 401:
            throw new Error('APIå¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç”ŸæˆPATä»¤ç‰Œ');
        case 403:
            throw new Error('æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥PATä»¤ç‰Œæƒé™è®¾ç½®');
        case 404:
            throw new Error('æœºå™¨äººä¸å­˜åœ¨æˆ–æœªå‘å¸ƒä¸ºAPIæœåŠ¡');
        case 429:
            throw new Error('è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·é™ä½è¯·æ±‚é¢‘ç‡');
        default:
            throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status} - ${errorData.msg}`);
    }
}
                    </div>
                </div>
                
                <div class="fix">
                    <h3>3. è¯·æ±‚å‚æ•°ä¼˜åŒ–</h3>
                    <p>ç¡®ä¿è¯·æ±‚å‚æ•°ç¬¦åˆCoze API v3è§„èŒƒï¼š</p>
                    <div class="code">
const requestBody = {
    bot_id: botId,                    // å¿…éœ€ï¼šæœºå™¨äººID
    user_id: generateUniqueUserId(),  // å¿…éœ€ï¼šå”¯ä¸€ç”¨æˆ·ID
    stream: false,                    // éæµå¼å“åº”
    auto_save_history: true,          // è‡ªåŠ¨ä¿å­˜å¯¹è¯å†å²
    additional_messages: [{           // æ¶ˆæ¯æ•°ç»„
        role: 'user',                 // è§’è‰²ï¼šuser/assistant
        content: message,             // æ¶ˆæ¯å†…å®¹
        content_type: 'text'          // å†…å®¹ç±»å‹ï¼štext/imageç­‰
    }]
};
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸš€ æµ‹è¯•å»ºè®®</h2>
                
                <div class="issue info">
                    <h3>åˆ†æ­¥æµ‹è¯•æµç¨‹</h3>
                    <ol>
                        <li><strong>é…ç½®éªŒè¯ï¼š</strong>ä½¿ç”¨ <a href="coze-error-debug.html" target="_blank">é”™è¯¯æ’æŸ¥å·¥å…·</a> éªŒè¯APIå¯†é’¥å’Œæœºå™¨äººIDæ ¼å¼</li>
                        <li><strong>æœºå™¨äººçŠ¶æ€æ£€æŸ¥ï¼š</strong>ç¡®è®¤æœºå™¨äººå·²å‘å¸ƒä¸”å¯è®¿é—®</li>
                        <li><strong>ç®€å•APIæµ‹è¯•ï¼š</strong>å‘é€ç®€å•æ¶ˆæ¯æµ‹è¯•åŸºæœ¬è¿æ¥</li>
                        <li><strong>å®Œæ•´æµç¨‹æµ‹è¯•ï¼š</strong>æµ‹è¯•å‘èµ·å¯¹è¯â†’è½®è¯¢çŠ¶æ€â†’è·å–æ¶ˆæ¯çš„å®Œæ•´æµç¨‹</li>
                        <li><strong>é”™è¯¯åœºæ™¯æµ‹è¯•ï¼š</strong>æ•…æ„ä½¿ç”¨é”™è¯¯é…ç½®æµ‹è¯•é”™è¯¯å¤„ç†</li>
                    </ol>
                </div>
                
                <div class="fix">
                    <h3>æ¨èçš„æµ‹è¯•å·¥å…·</h3>
                    <p>ä½¿ç”¨é¡¹ç›®ä¸­çš„ä¸“ç”¨æµ‹è¯•é¡µé¢ï¼š</p>
                    <ul>
                        <li>ğŸ”§ <a href="coze-error-debug.html" target="_blank">coze-error-debug.html</a> - é”™è¯¯æ’æŸ¥å’ŒAPIæµ‹è¯•</li>
                        <li>ğŸ“¡ <a href="coze-retrieve-chat.html" target="_blank">coze-retrieve-chat.html</a> - retrieve_chatåŠŸèƒ½æ¼”ç¤º</li>
                        <li>ğŸ¯ å½“å‰é¡µé¢çš„ä¸»è¦åŠŸèƒ½ - è¯æœ¯ç”Ÿæˆæµ‹è¯•</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ“š å‚è€ƒæ–‡æ¡£</h2>
                <div class="issue info">
                    <h3>å®˜æ–¹æ–‡æ¡£é“¾æ¥</h3>
                    <ul>
                        <li>ğŸ”— <a href="https://www.coze.cn/open/docs/developer_guides/chat_v3" target="_blank">Coze Chat API v3 æ–‡æ¡£</a></li>
                        <li>ğŸ”— <a href="https://www.coze.cn/open/docs/developer_guides/retrieve_chat" target="_blank">è·å–å¯¹è¯è¯¦æƒ…æ–‡æ¡£</a></li>
                        <li>ğŸ”— <a href="https://www.coze.cn/open/docs/developer_guides/list_chat_messages" target="_blank">è·å–å¯¹è¯æ¶ˆæ¯åˆ—è¡¨æ–‡æ¡£</a></li>
                        <li>ğŸ”— <a href="https://www.coze.cn/open/docs/developer_guides/coze_error_codes" target="_blank">Cozeé”™è¯¯ç æ–‡æ¡£</a></li>
                    </ul>
                </div>
                
                <div class="issue info">
                    <h3>å…³é”®APIç«¯ç‚¹</h3>
                    <div class="code">
# å‘èµ·å¯¹è¯
POST https://api.coze.cn/v3/chat

# æŸ¥è¯¢å¯¹è¯çŠ¶æ€
GET https://api.coze.cn/v3/chat/retrieve?conversation_id={id}&chat_id={id}

# è·å–å¯¹è¯æ¶ˆæ¯
GET https://api.coze.cn/v3/chat/message/list?conversation_id={id}&chat_id={id}
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ¯ å¿«é€Ÿæ“ä½œ</h2>
                <button class="btn" onclick="window.open('coze-error-debug.html', '_blank')">ğŸ”§ æ‰“å¼€é”™è¯¯æ’æŸ¥å·¥å…·</button>
                <button class="btn success" onclick="window.open('coze-retrieve-chat.html', '_blank')">ğŸ“¡ æµ‹è¯•retrieve_chatåŠŸèƒ½</button>
                <button class="btn warning" onclick="window.open('index.html', '_blank')">ğŸ¯ è¿”å›ä¸»é¡µé¢æµ‹è¯•</button>
                <button class="btn" onclick="window.open('https://www.coze.cn/open/docs/developer_guides/chat_v3', '_blank')">ğŸ“š æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</button>
            </div>
        </div>
    </div>
    
    <script>
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Coze API è¯Šæ–­æŠ¥å‘Šå·²åŠ è½½ ===');
            console.log('å½“å‰æ—¶é—´:', new Date().toLocaleString());
            console.log('ç”¨æˆ·ä»£ç†:', navigator.userAgent);
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„APIé…ç½®
            const apiKey = localStorage.getItem('coze_api_key');
            const botId = localStorage.getItem('coze_bot_id');
            
            if (apiKey || botId) {
                console.log('æ£€æµ‹åˆ°æœ¬åœ°APIé…ç½®:');
                console.log('- APIå¯†é’¥çŠ¶æ€:', apiKey ? 'å·²é…ç½®' : 'æœªé…ç½®');
                console.log('- æœºå™¨äººIDçŠ¶æ€:', botId ? 'å·²é…ç½®' : 'æœªé…ç½®');
            } else {
                console.log('æœªæ£€æµ‹åˆ°æœ¬åœ°APIé…ç½®ï¼Œè¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®');
            }
        });
    </script>
</body>
</html>